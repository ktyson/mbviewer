<html>
<head>

<script src="jquery-2.1.1.min.js"></script>
<script src="pilot.js"></script>

<script>

var c0, c1, c2, c3, c4;
var ctx0, ctx1, ctx2, ctx3, ctx4;

var id; 
var d; 

var maxSize = 4;
var maxCount = 200;
var xcorner = -2;
var ycorner = -1.5;

var xcenter = -0.5;
var ycenter = 0;

var width = 300;
var height = 300;

var xoffset = 0;
var yoffset = 0;
var zoom = 3;

$(document).ready(function(){

	c0 = document.getElementById("myCanvas0");
	ctx0 = c0.getContext("2d");
	
	c1 = document.getElementById("myCanvas1");
	ctx1 = c1.getContext("2d");
	
	c2 = document.getElementById("myCanvas2");
	ctx2 = c2.getContext("2d");
	
	c3 = document.getElementById("myCanvas3");
	ctx3 = c3.getContext("2d");
	
	//c4 = document.getElementById("myCanvas4");
	//ctx4 = c4.getContext("2d");

	$("#go").on("click", function(){
		getArrayMB(0);
		getArrayMB(1);
		getArrayMB(2);
		getArrayMB(3);
		//getArrayMB(4);				
		//paintIt(zoom, xcorner, ycorner, width, height, maxCount, maxSize);
	});		
	
	$("#step").on("click", function(){				
		doStep();
	});	

	$("#fall").on("click", function(){
		doFall();
	});
		

	$("#myCanvas0").on("mousemove", function(e) {
		var posX = $(this).position().left;
		var posY = $(this).position().top;
		doAim(e, posX, posY, false);
	});

	$("#myCanvas0").on("click", function(e) {	
		var posX = $(this).position().left;
		var posY = $(this).position().top;
		doAim(e, posX, posY, true);
	});


});



function doFall() {
	timer = window.setInterval(function () {

		if(zoom < 0.00001 || maxCount > 400) {
			clear();
		} else {
			doStep();
		}

	}, 1000);
	
	function clear(){
		window.clearInterval(timer);
		alert("done");
	}
}

function doStep() {

	var per = 5;

	xcorner = xcorner + (zoom/per);
	ycorner = ycorner + (zoom/per);
	zoom = zoom - (zoom/per)*2;
	maxCount = maxCount + 5;

	$("#maxCount").val(maxCount + '');
	$("#xcorner").val(xcorner + '');
	$("#ycorner").val(ycorner + '');
	$("#zoom").val(zoom + '');
		
	getArrayMB(0);
	getArrayMB(1);
	getArrayMB(2);
	getArrayMB(3);
	//getArrayMB(4);
	//paintIt(zoom, xcorner, ycorner, width, height, maxCount, maxSize);
	//console.log(zoom, xcorner, ycorner, width, height, maxCount, maxSize);

}

function doAim(e, posX, posY, isClick) {

	var realX = (e.pageX - posX);
	var realY = height - (e.pageY - posY);	

	var scaleDown = zoom/width;	

	var scaleX = xcorner + (realX * scaleDown);
	var scaleY = ycorner + (realY * scaleDown);	
	
	$("#xlive").val(scaleX + '');
	$("#ylive").val(scaleY + '');

	if(isClick) {
	
		//xcenter = parseFloat($("#xcenter").val());
		//ycenter = parseFloat($("#ycenter").val());

		xoffset = scaleX - xcenter;
		yoffset = scaleY - ycenter;
		
		xcenter = xcenter + xoffset;
		ycenter = ycenter - yoffset;
		
		xcorner = xcorner + xoffset;
		ycorner = ycorner - yoffset;

		//console.log("x", scaleX, "y", scaleY);
		$("#xcenter").val(scaleX + '');
		$("#ycenter").val(scaleY + '');
		$("#xoffset").val(xoffset + '');
		$("#yoffset").val(yoffset + '');
		$("#xcorner").val(xcorner + '');
		$("#ycorner").val(ycorner + '');		
		
			
	}
}


function getArrayMB(which) {
	
	var wid;
	var ht;
	var ctx;
	
	switch(which) {
	
		case 0:
			//main screen
			wid = 300;
			ht = 300;
			ctx = ctx0;
			break;
		case 1:
			//ctx1
			wid = 100;
			ht = 100;
			ctx = ctx1;
			break;
		case 2:
			//ctx1
			wid = 100;
			ht = 100;
			ctx = ctx2;
			break;
		case 3:
			//ctx1
			wid = 100;
			ht = 100;
			ctx = ctx3;
			break;
// 		case 4:
// 			//ctx1
// 			wid = 40;
// 			ht = 40;
// 			ctx = ctx4;
// 			break;
		default:
		
		}
	
	var arr = [];
	arr = getArray(zoom, xcorner, ycorner, wid, ht, maxCount, maxSize);	
	
	paintIt(arr, ctx, which, zoom, xcorner, ycorner, width, height, maxCount, maxSize);

}


function paintIt(arr, ctx, which, zoom, xcorner, ycorner, width, height, maxCount, maxSize) {


var startTime = new Date();

var arrTime = new Date();	
console.log("array time for " + which + ": " + (arrTime - startTime)/1000);
	         
	$.each(arr, function(idx, val){

		ctx.fillStyle = "rgba("+val.clr.r+","+val.clr.g+","+val.clr.b+",1)";
		ctx.fillRect( val.x, val.y, 1, 1 );

	});
	

var endTime = new Date();
console.log("paint time: " + (endTime - startTime)/1000);

}


</script>


</head>

<body>

x-corner<input id='xcorner' value='-2' size='30'></input>
y-corner<input id='ycorner' value='-1.5' size='30'></input><br/>
x-center<input id='xcenter' value='-0.5' size='30'></input>
y-center<input id='ycenter' value='0' size='30'></input><br/>
x-offset<input id='xoffset' value='0' size='30'></input>
y-offset<input id='yoffset' value='0' size='30'></input><br/>
x-live<input id='xlive' value='0' size='30'></input>
y-live<input id='ylive' value='0' size='30'></input><br/>
zoom<input id='zoom' value='3' size='30'></input><br/>
maxIters<input id='maxCount' value='200' size='4'></input>
<!--maxSize<input id='maxSize' value='4' size='4'></input>
<input type='button' id='enhance' value='ENHANCE'></input>-->
<input type='button' id='go' value='GO'></input>
<input type='button' id='step' value='STEP'></input>
<input type='button' id='fall' value='FALL'></input>
<br/>

<div id="container" width="320">
	<div style="display:inline-block">
	<canvas id="myCanvas1" width="100" height="100"
	style="border:1px solid #000000; cursor:crosshair">
	</canvas>
	</div>

	<div style="display:inline-block">
	<canvas id="myCanvas2" width="100" height="100"
	style="border:1px solid #000000; cursor:crosshair">
	</canvas>
	</div>

	<div style="display:inline-block">
	<canvas id="myCanvas3" width="100" height="100"
	style="border:1px solid #000000; cursor:crosshair">
	</canvas>
	</div>

<!-- 
	<div style="display:inline-block">
	<canvas id="myCanvas4" width="40" height="40"
	style="border:1px solid #000000; cursor:crosshair">
	</canvas>
	</div>
 -->
<div>

<div id="maindisplay" width="300">
	<div  style="float:none">
	<canvas id="myCanvas0" width="300" height="300"
	style="border:1px solid #000000; cursor:crosshair">
	</canvas>
	</div>
</div>

</body>
</html>















 