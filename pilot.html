<html>
<head>

<script src="jquery-2.1.1.min.js"></script>
<script src="pilot.js"></script>

<script>

var c;
var ctx;
var id; 
var d; 

var maxSize = 4;
var maxCount = 200;
var xcorner = -2;
var ycorner = -1.5;

var xcenter = -0.5;
var ycenter = 0;

var width = 400;
var height = 400;

var xoffset = 0;
var yoffset = 0;
var zoom = 3;

$(document).ready(function(){

	c = document.getElementById("myCanvas");
	ctx = c.getContext("2d");

	$("#go").on("click", function(){				
		paintIt(zoom, xcorner, ycorner, width, height, maxCount, maxSize);
	});		
	
	$("#step").on("click", function(){				
		doStep();
	});	

	$("#fall").on("click", function(){
		doFall();
	});
		

	$("#myCanvas").on("mousemove", function(e) {
		var posX = $(this).position().left;
		var posY = $(this).position().top;
		doAim(e, posX, posY, false);
	});

	$("#myCanvas").on("click", function(e) {	
		var posX = $(this).position().left;
		var posY = $(this).position().top;
		doAim(e, posX, posY, true);
	});

});


function doFall() {
	timer = window.setInterval(function () {

		if(zoom < 0.00001 || maxCount > 400) {
			clear();
		} else {
			doStep();
		}

	}, 6000);
	
	function clear(){
		window.clearInterval(timer);
		alert("done");
	}
}

function doStep() {

	var per = 5;

	xcorner = xcorner + (zoom/per);
	ycorner = ycorner + (zoom/per);
	zoom = zoom - (zoom/per)*2;
	maxCount = maxCount + 5;

	$("#maxCount").val(maxCount + '');
	$("#xcorner").val(xcorner + '');
	$("#ycorner").val(ycorner + '');
	$("#zoom").val(zoom + '');

	paintIt(zoom, xcorner, ycorner, width, height, maxCount, maxSize);
	//console.log(zoom, xcorner, ycorner, width, height, maxCount, maxSize);

}

function doAim(e, posX, posY, isClick) {

	var realX = (e.pageX - posX);
	var realY = height - (e.pageY - posY);	

	var scaleDown = zoom/width;	

	var scaleX = xcorner + (realX * scaleDown);
	var scaleY = ycorner + (realY * scaleDown);	
	
	$("#xlive").val(scaleX + '');
	$("#ylive").val(scaleY + '');

	if(isClick) {
	
		//xcenter = parseFloat($("#xcenter").val());
		//ycenter = parseFloat($("#ycenter").val());

		xoffset = scaleX - xcenter;
		yoffset = scaleY - ycenter;
		
		xcenter = xcenter + xoffset;
		ycenter = ycenter - yoffset;
		
		xcorner = xcorner + xoffset;
		ycorner = ycorner - yoffset;

		//console.log("x", scaleX, "y", scaleY);
		$("#xcenter").val(scaleX + '');
		$("#ycenter").val(scaleY + '');
		$("#xoffset").val(xoffset + '');
		$("#yoffset").val(yoffset + '');
		$("#xcorner").val(xcorner + '');
		$("#ycorner").val(ycorner + '');		
		
			
	}
}



function paintIt(zoom, xcorner, ycorner, width, height, maxCount, maxSize) {


var startTime = new Date();

	var arr = [];
	arr = getArray(zoom, xcorner, ycorner, width, height, maxCount, maxSize);	
         
	$.each(arr, function(idx, val){

		ctx.fillStyle = "rgba("+val.clr.r+","+val.clr.g+","+val.clr.b+",1)";
		ctx.fillRect( val.x, val.y, 1, 1 );

	});
	

var endTime = new Date();
console.log("time " + (endTime - startTime)/1000);


}


</script>


</head>

<body>

x-corner<input id='xcorner' value='-2' size='10'></input>
y-corner<input id='ycorner' value='-1.5' size='10'></input><br/>
x-center<input id='xcenter' value='-0.5' size='10'></input>
y-center<input id='ycenter' value='0' size='10'></input><br/>
x-offset<input id='xoffset' value='0' size='10'></input>
y-offset<input id='yoffset' value='0' size='10'></input><br/>
x-live<input id='xlive' value='0' size='10'></input>
y-live<input id='ylive' value='0' size='10'></input><br/>
zoom<input id='zoom' value='3' size='10'></input><br/>
maxIters<input id='maxCount' value='200' size='4'></input>
<!--maxSize<input id='maxSize' value='4' size='4'></input>
<input type='button' id='enhance' value='ENHANCE'></input>-->
<input type='button' id='go' value='GO'></input>
<input type='button' id='step' value='STEP'></input>
<input type='button' id='fall' value='FALL'></input>
<br/>

<canvas id="myCanvas" width="400" height="400"
style="border:1px solid #000000; cursor:crosshair;">
</canvas>

</body>
</html>















 